---
title: Initialize
description: Create a new stake pool with initial configuration.
---

## Overview

| Property | Value |
|----------|-------|
| Instruction Index | 0 |
| Required Authority | Pool creator |

The `Initialize` instruction creates a new stake pool with the specified fee structure, authorities, and configuration. All associated accounts (validator list, reserve, mint) must be created beforehand.

## Accounts

| Index | Name | Writable | Signer | Description |
|-------|------|----------|--------|-------------|
| 0 | Stake Pool | ✅ | ❌ | Uninitialized stake pool account |
| 1 | Manager | ❌ | ✅ | Pool manager (pays for initialization) |
| 2 | Staker | ❌ | ❌ | Staker authority for the pool |
| 3 | Withdraw Authority | ❌ | ❌ | Pool withdraw authority PDA |
| 4 | Validator List | ✅ | ❌ | Uninitialized validator list account |
| 5 | Reserve Stake | ❌ | ❌ | Reserve stake account |
| 6 | Pool Mint | ✅ | ❌ | Pool token mint |
| 7 | Manager Fee Account | ❌ | ❌ | Manager's token account for fees |
| 8 | Token Program | ❌ | ❌ | SPL Token program |
| 9 | (Optional) Deposit Authority | ❌ | ❌ | Restrict deposits to this signer |

## Arguments

```rust
pub struct InitializeArgs {
    /// Fee assessed on epoch rewards
    pub fee: Fee,
    /// Fee assessed on withdrawals  
    pub withdrawal_fee: Fee,
    /// Fee assessed on deposits
    pub deposit_fee: Fee,
    /// Percentage of deposit fee for referrers
    pub referral_fee: u8,
    /// Maximum validators allowed in pool
    pub max_validators: u32,
}

pub struct Fee {
    pub numerator: u64,
    pub denominator: u64,
}
```

| Field | Type | Description |
|-------|------|-------------|
| `fee` | Fee | Epoch fee taken from staking rewards |
| `withdrawal_fee` | Fee | Fee on stake/SOL withdrawals |
| `deposit_fee` | Fee | Fee on stake/SOL deposits |
| `referral_fee` | u8 | Referrer's share of deposit fee (0-100) |
| `max_validators` | u32 | Maximum validators (determines list size) |

## Behavior

1. Validates stake pool account is uninitialized
2. Validates validator list is uninitialized and correctly sized
3. Validates reserve stake account:
   - Owned by Stake Program
   - Has pool's withdraw authority
   - Is initialized but not delegated
4. Validates pool mint:
   - Supply is 0
   - Mint authority is withdraw authority PDA
   - Freeze authority is None
5. Validates manager fee account is valid token account for pool mint
6. Initializes stake pool state
7. Initializes validator list header

## Prerequisites

Before calling Initialize, you must create:

### 1. Stake Pool Account

```typescript
const stakePoolSpace = 611; // StakePool account size
const stakePoolRent = await connection.getMinimumBalanceForRentExemption(stakePoolSpace);

const createPoolIx = SystemProgram.createAccount({
    fromPubkey: payer.publicKey,
    newAccountPubkey: stakePool.publicKey,
    lamports: stakePoolRent,
    space: stakePoolSpace,
    programId: STAKE_POOL_PROGRAM_ID,
});
```

### 2. Validator List Account

```typescript
const validatorListSpace = 5 + (73 * maxValidators);
const validatorListRent = await connection.getMinimumBalanceForRentExemption(validatorListSpace);

const createListIx = SystemProgram.createAccount({
    fromPubkey: payer.publicKey,
    newAccountPubkey: validatorList.publicKey,
    lamports: validatorListRent,
    space: validatorListSpace,
    programId: STAKE_POOL_PROGRAM_ID,
});
```

### 3. Reserve Stake Account

```typescript
const [withdrawAuthority] = PublicKey.findProgramAddressSync(
    [stakePool.publicKey.toBuffer(), Buffer.from('withdraw')],
    STAKE_POOL_PROGRAM_ID
);

// Create and initialize stake account with withdraw authority as authorities
const createReserveIx = StakeProgram.createAccount({
    fromPubkey: payer.publicKey,
    stakePubkey: reserveStake.publicKey,
    authorized: {
        staker: withdrawAuthority,
        withdrawer: withdrawAuthority,
    },
    lamports: stakeAccountRent,
});
```

### 4. Pool Token Mint

```typescript
const createMintIx = createInitializeMint2Instruction(
    poolMint.publicKey,
    9,                    // decimals
    withdrawAuthority,    // mint authority
    null,                 // freeze authority (must be null)
    TOKEN_PROGRAM_ID
);
```

### 5. Manager Fee Account

```typescript
const createFeeAccountIx = createAssociatedTokenAccountInstruction(
    payer.publicKey,
    managerFeeAccount,
    manager.publicKey,
    poolMint.publicKey
);
```

## Examples

### Rust

```rust
use spl_stake_pool::{
    instruction::initialize,
    state::Fee,
};

fn create_stake_pool(
    client: &RpcClient,
    payer: &Keypair,
    manager: &Keypair,
    staker: &Pubkey,
) -> Result<Pubkey, Box<dyn std::error::Error>> {
    let stake_pool = Keypair::new();
    let validator_list = Keypair::new();
    let reserve_stake = Keypair::new();
    let pool_mint = Keypair::new();
    
    // Derive withdraw authority
    let (withdraw_authority, _) = Pubkey::find_program_address(
        &[stake_pool.pubkey().as_ref(), b"withdraw"],
        &spl_stake_pool::id(),
    );
    
    // Create all prerequisite accounts...
    // (See prerequisites section above)
    
    // Initialize the stake pool
    let init_ix = initialize(
        &spl_stake_pool::id(),
        &stake_pool.pubkey(),
        &manager.pubkey(),
        staker,
        &withdraw_authority,
        &validator_list.pubkey(),
        &reserve_stake.pubkey(),
        &pool_mint.pubkey(),
        &manager_fee_account,
        &spl_token::id(),
        None, // No deposit authority restriction
        Fee { numerator: 5, denominator: 100 },    // 5% epoch fee
        Fee { numerator: 1, denominator: 1000 },   // 0.1% withdrawal fee
        Fee { numerator: 1, denominator: 1000 },   // 0.1% deposit fee
        0,    // No referral fee
        1000, // Max 1000 validators
    );
    
    let tx = Transaction::new_signed_with_payer(
        &[/* prerequisite ixs */, init_ix],
        Some(&payer.pubkey()),
        &[payer, manager, &stake_pool, &validator_list, &reserve_stake, &pool_mint],
        client.get_latest_blockhash()?,
    );
    
    client.send_and_confirm_transaction(&tx)?;
    
    Ok(stake_pool.pubkey())
}
```

### CLI

```bash
# Using spl-stake-pool CLI
spl-stake-pool create-pool \
    --epoch-fee-numerator 5 \
    --epoch-fee-denominator 100 \
    --withdrawal-fee-numerator 1 \
    --withdrawal-fee-denominator 1000 \
    --deposit-fee-numerator 1 \
    --deposit-fee-denominator 1000 \
    --max-validators 1000 \
    --pool-keypair pool.json
```

## Errors

| Error | Cause |
|-------|-------|
| `AlreadyInUse` | Stake pool already initialized |
| `InvalidState` | Validator list wrong size or pre-initialized |
| `WrongAccountMint` | Manager fee account wrong mint |
| `InvalidProgramAddress` | Withdraw authority PDA mismatch |
| `FeeTooHigh` | Fee numerator > denominator |
| `InvalidFeeAccount` | Manager fee account invalid |

## Security Considerations

- **Withdraw Authority**: Must be the correct PDA - controls all pool funds
- **Freeze Authority**: Pool mint must have no freeze authority
- **Manager Selection**: Manager can modify fees and pool settings
- **Max Validators**: Choose carefully - validator list cannot be resized
