---
title: Instructions
description: Complete reference for all SPL Stake Pool program instructions.
---

The SPL Stake Pool program provides 24 instructions organized by function. Each instruction is documented with its accounts, arguments, behavior, and examples.

## Instruction Index

| Index | Instruction | Description |
|-------|-------------|-------------|
| 0 | [Initialize](./0_initialize) | Create a new stake pool |
| 1 | [AddValidatorToPool](./1_add_validator_to_pool) | Add a validator to the pool |
| 2 | [RemoveValidatorFromPool](./2_remove_validator_from_pool) | Remove a validator from the pool |
| 3 | [IncreaseValidatorStake](./3_increase_validator_stake) | Increase stake to a validator |
| 4 | [DecreaseValidatorStakeWithReserve](./4_decrease_validator_stake) | Decrease stake from a validator |
| 5 | [UpdateValidatorListBalance](./5_update_validator_list_balance) | Update validator stake balances |
| 6 | [UpdateStakePoolBalance](./6_update_stake_pool_balance) | Update pool totals and fees |
| 7 | [CleanupRemovedValidatorEntries](./7_cleanup_removed_validator_entries) | Remove inactive validator entries |
| 8 | [DepositStake](./8_deposit_stake) | Deposit a stake account |
| 9 | [WithdrawStake](./9_withdraw_stake) | Withdraw stake from pool |
| 10 | [SetManager](./10_set_manager) | Change pool manager |
| 11 | [SetFee](./11_set_fee) | Update fee parameters |
| 12 | [SetStaker](./12_set_staker) | Change staker authority |
| 13 | [DepositSol](./13_deposit_sol) | Deposit SOL directly |
| 14 | [SetFundingAuthority](./14_set_funding_authority) | Set deposit/withdraw authority |
| 15 | [WithdrawSol](./15_withdraw_sol) | Withdraw SOL from reserve |
| 16 | [CreateTokenMetadata](./16_create_token_metadata) | Create MPL token metadata |
| 17 | [UpdateTokenMetadata](./17_update_token_metadata) | Update token metadata |
| 18 | [DepositStakeWithAuthority](./18_deposit_stake_with_authority) | Deposit stake with authority |
| 19 | [SetPreferredValidator](./19_set_preferred_validator) | Set preferred validator |
| 20 | [IncreaseAdditionalValidatorStake](./20_increase_additional_validator_stake) | Additional stake increase |
| 21 | [DecreaseAdditionalValidatorStake](./21_decrease_additional_validator_stake) | Additional stake decrease |
| 22 | [Redelegate](./22_redelegate) | Transfer stake between validators |
| 23 | [DepositStakeWithSlippage](./23_deposit_stake_with_slippage) | Deposit stake with slippage protection |
| 24 | [WithdrawStakeWithSlippage](./24_withdraw_stake_with_slippage) | Withdraw stake with slippage protection |
| 25 | [DepositSolWithSlippage](./25_deposit_sol_with_slippage) | Deposit SOL with slippage protection |
| 26 | [WithdrawSolWithSlippage](./26_withdraw_sol_with_slippage) | Withdraw SOL with slippage protection |

## Instruction Categories

### Pool Initialization

| Instruction | Required Authority |
|-------------|-------------------|
| Initialize | Pool creator |

### Validator Management

| Instruction | Required Authority |
|-------------|-------------------|
| AddValidatorToPool | Staker |
| RemoveValidatorFromPool | Staker |
| SetPreferredValidator | Manager |

### Stake Rebalancing

| Instruction | Required Authority |
|-------------|-------------------|
| IncreaseValidatorStake | Staker |
| DecreaseValidatorStakeWithReserve | Staker |
| IncreaseAdditionalValidatorStake | Staker |
| DecreaseAdditionalValidatorStake | Staker |
| Redelegate | Staker |

### Epoch Maintenance

| Instruction | Required Authority |
|-------------|-------------------|
| UpdateValidatorListBalance | None (permissionless) |
| UpdateStakePoolBalance | None (permissionless) |
| CleanupRemovedValidatorEntries | None (permissionless) |

### User Operations

| Instruction | Required Authority |
|-------------|-------------------|
| DepositStake | User (stake owner) |
| DepositSol | User |
| WithdrawStake | User (token holder) |
| WithdrawSol | User (token holder) |
| DepositStakeWithSlippage | User (stake owner) |
| DepositSolWithSlippage | User |
| WithdrawStakeWithSlippage | User (token holder) |
| WithdrawSolWithSlippage | User (token holder) |

### Administration

| Instruction | Required Authority |
|-------------|-------------------|
| SetManager | Manager |
| SetFee | Manager |
| SetStaker | Manager |
| SetFundingAuthority | Manager |
| CreateTokenMetadata | Manager |
| UpdateTokenMetadata | Manager |

## Common Patterns

### Building Instructions

```typescript
import {
    StakePoolInstruction,
    depositSol,
    withdrawStake,
} from '@solana/spl-stake-pool';

// Create a deposit instruction
const depositIx = depositSol(
    stakePoolAddress,
    userWallet,
    userTokenAccount,
    reserveStake,
    poolMint,
    feeAccount,
    referrerAccount,  // optional
    amount
);

// Create a withdrawal instruction
const withdrawIx = withdrawStake(
    stakePoolAddress,
    validatorList,
    withdrawAuthority,
    validatorStake,
    destinationStake,
    destinationStakeAuthority,
    sourceTokenAccount,
    poolMint,
    tokenProgramId,
    amount
);
```

### Error Handling

All instructions can return these common errors:

| Error | Description |
|-------|-------------|
| `InvalidState` | Pool not in expected state |
| `WrongAccountMint` | Token account mint mismatch |
| `SignatureMissing` | Required signer not present |
| `InvalidProgramAddress` | PDA derivation mismatch |
| `StakeListOutOfDate` | Validator list needs update |

## Instruction Encoding

Instructions use borsh serialization with a single-byte discriminator:

```rust
#[derive(BorshSerialize, BorshDeserialize)]
pub enum StakePoolInstruction {
    Initialize { fee: Fee, withdrawal_fee: Fee, ... },  // 0
    AddValidatorToPool,                                  // 1
    RemoveValidatorFromPool,                             // 2
    // ... etc
}
```

## Compute Budget

Recommended compute unit limits:

| Instruction | Compute Units |
|-------------|---------------|
| Initialize | ~50,000 |
| AddValidatorToPool | ~30,000 |
| IncreaseValidatorStake | ~50,000 |
| UpdateValidatorListBalance | ~100,000 per batch |
| UpdateStakePoolBalance | ~50,000 |
| DepositStake | ~60,000 |
| DepositSol | ~40,000 |
| WithdrawStake | ~70,000 |
| WithdrawSol | ~40,000 |
